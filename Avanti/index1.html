<!DOCTYPE html>
<html lang="en">
<head>
	<title>Mapping with D3</title>
	<script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
	<script src = "https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script id="data" type="application/json" src="world50m.json"></script>
	<link rel="stylesheet" href="viz_style.css">
</head>
<body>
	<!-- Page elements and content go here. -->
	<script>
		// <!-- Width-Heigh t-->
		var width = 3000;
		var height = 1500;

		// Projection
		var projection = d3
	   .geoEquirectangular()
	   .center([0, 15]) // set centre to further North
	   .scale([width/(2*Math.PI)]) // scale to fit group width
	   .translate([width/2,height/2]) // ensure centred in group

	   // Define Map Path

	   var path = d3
	   .geoPath()
	   .projection(projection);

	   // apply zoom to countriesGroup
		function zoomed() {
		   t = d3
		      .event
		      .transform
		   ;
		   countriesGroup.attr(
		      "transform","translate(" + [t.x, t.y] + ")scale(" + t.k + ")"
		   );
		}
		// Define map zoom behaviour
		var zoom = d3
		   .zoom()
		   .on("zoom", zoomed);

		function getTextBox(selection) {
		  selection.each(function(d) {
		    d.bbox = this.getBBox();
		  });
		}
		// Draw the Map
		var svg = d3
		  .select("#map-holder")
		  .append("svg")
		  // set to the same size as the "map-holder" div
		  .attr("width", $("#map-holder").width())
		  .attr("height", $("#map-holder").height())
		  // add zoom functionality
		  .call(zoom);
		 
		 //Load the Map

		 d3.json(
		  "https://raw.githubusercontent.com/andybarefoot/andybarefoot-www/master/maps/mapdata/custom50.json",
		  function(json) {
		     countriesGroup = svg
		   	.append("g")
		   	.attr("id", "map");

		// add a background rectangle
		countriesGroup
		   .append("rect")
		   .attr("x", 0)
		   .attr("y", 0)
		   .attr("width", $("#map-holder").width())
		   .attr("height", $("#map-holder").height());

  		// draw a path for each feature/country
		countries = countriesGroup
		   .selectAll("path")
		   .data(json.features)
		   .enter()
		   .append("path")
		   .attr("d", path)
		   .attr("id", function(d, i) {
		      return "country" + d.properties.iso_a3;
		   })
		   .attr("class", "country")

		   // add a mouseover action to show name label for feature/country
		   .on("mouseover", function(d, i) {
		      d3.select("#countryLabel" + d.properties.iso_a3).style("display", "block");
		   })
		   .on("mouseout", function(d, i) {
		      d3.select("#countryLabel" + d.properties.iso_a3).style("display", "none");
		   })
		   // add an onclick action to zoom into clicked country
		   .on("click", function(d, i) {
		      d3.selectAll(".country").classed("country-on", false);
		      d3.select(this).classed("country-on", true);
		      boxZoom(path.bounds(d), path.centroid(d), 20);
		   });

		 countryLabels = countriesGroup
	   .selectAll("g")
	   .data(json.features)
	   .enter()
	   .append("g")
	   .attr("class", "countryLabel")
	   .attr("id", function(d) {
	      return "countryLabel" + d.properties.iso_a3;
	   })
	   .attr("transform", function(d) {
	      return (
	         "translate(" + path.centroid(d)[0] + "," + path.centroid(d)[1] + ")"
	      );
	   })
	   // add mouseover functionality to the label
	   .on("mouseover", function(d, i) {
	      d3.select(this).style("display", "block");
	   })
	   .on("mouseout", function(d, i) {
	       d3.select(this).style("display", "none");
	   })   
	   // add an onlcick action to zoom into clicked country
	   .on("click", function(d, i) {
	      d3.selectAll(".country").classed("country-on", false);
	      d3.select("#country" + d.properties.iso_a3).classed("country-on", true);
	      boxZoom(path.bounds(d), path.centroid(d), 20);
	   });
  		});
		
	</script>	
	<div id="map-holder"></div>
</body>
</html>

